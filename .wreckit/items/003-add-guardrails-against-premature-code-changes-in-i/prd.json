{
  "schema_version": 1,
  "id": "003-add-guardrails-against-premature-code-changes-in-i",
  "branch_name": "wreckit/003-add-guardrails-against-premature-code-changes-in-i",
  "user_stories": [
    {
      "id": "US-001",
      "title": "Add git status check and warning to ideasCommand",
      "acceptance_criteria": [
        "Import hasUncommittedChanges and isGitRepo from src/git in src/commands/ideas.ts",
        "Create warnIfUncommittedChanges helper function that checks for uncommitted changes",
        "Call warnIfUncommittedChanges at start of ideasCommand function after finding root",
        "Warning message includes: warning emoji, clear explanation that idea phase is read-only, suggestion to commit first",
        "Warning is non-blocking - execution continues after warning is displayed",
        "Check is skipped in dry-run mode (consistent with workflow patterns)",
        "Check is skipped when not in a git repo (graceful degradation)",
        "No errors thrown when checking git status in non-git repos"
      ],
      "priority": 1,
      "status": "done",
      "notes": "This is the primary entry point for idea capture (file input, stdin input). The warning should appear before any agent work begins. Use existing hasUncommittedChanges utility - no new git logic needed."
    },
    {
      "id": "US-002",
      "title": "Add git status check and warning to runIdeaInterview",
      "acceptance_criteria": [
        "Import hasUncommittedChanges and isGitRepo from src/git in src/domain/ideas-interview.ts",
        "Add git status check at start of runIdeaInterview function after building SDK environment",
        "Warning is displayed via console.log (not logger) with line breaks for readability",
        "Warning includes: warning emoji, clear explanation, suggestion to commit/stash for clean slate",
        "Check is skipped when not in a git repo (graceful degradation)",
        "Interview proceeds normally after warning is displayed (non-blocking)",
        "Warning appears before any interview UI elements (header, greeting, etc.)"
      ],
      "priority": 2,
      "status": "done",
      "notes": "Interview mode is a separate entry point from ideasCommand. The warning should appear before the interview starts so users can stash/commit if they want a clean slate. Use console.log for multi-line formatting since this is interactive UI, not logger output."
    },
    {
      "id": "US-003",
      "title": "Add unit tests for git warning behavior",
      "acceptance_criteria": [
        "Add test suite 'ideasCommand - git warnings' in src/__tests__/commands/ideas.test.ts",
        "Test case: warns when uncommitted changes exist (creates file, runs command, checks logger.messages for warning)",
        "Test case: does not warn when repo is clean (no files changed, verifies no warning in logger)",
        "Test case: does not warn in dry-run mode even with changes (dryRun: true, verifies warning skipped)",
        "Test case: does not warn outside git repo (removes .git dir, verifies no warning and no errors)",
        "All new tests pass with mocked hasUncommittedChanges and isGitRepo functions",
        "All existing tests still pass after changes"
      ],
      "priority": 3,
      "status": "done",
      "notes": "Tests should mock the git utility functions to control scenarios without needing actual git operations. Use the existing mockLogger pattern from the test file. Verify warnings appear in logger.messages array."
    }
  ]
}
