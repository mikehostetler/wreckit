{
  "schema_version": 1,
  "id": "080-sandbox-diagnostics-cleanup",
  "title": "Implement Sandbox Diagnostics & Cleanup (Doctor Integration)",
  "section": "infrastructure",
  "state": "critique",
  "overview": "Integrate Sprite/Sandbox health checks into `wreckit doctor` and add automated cleanup for orphaned VMs. This ensures the sandbox environment is healthy and prevents resource leaks from crashed sessions.",
  "branch": null,
  "pr_url": null,
  "pr_number": null,
  "last_error": null,
  "created_at": "2026-01-28T06:00:00.000Z",
  "updated_at": "2026-01-28T04:56:19.029Z",
  "problem_statement": "Currently, if Wreckit crashes hard (power loss, OOM), ephemeral VMs may be left running indefinitely. Additionally, there is no unified way to verify that the Sprite CLI and authentication are correctly configured before running a task.",
  "motivation": "To provide a robust 'health check' for the sandbox system and a 'garbage collector' to prevent cost overruns from orphaned VMs.",
  "success_criteria": [
    "`wreckit doctor` checks for Sprite CLI installation",
    "`wreckit doctor` checks for valid SPRITES_TOKEN",
    "`wreckit doctor` identifies orphaned `wreckit-sandbox-*` VMs",
    "`wreckit doctor --fix` kills orphaned VMs",
    "Diagnostics provide actionable error messages"
  ],
  "technical_constraints": [
    "Must be safe (don't kill VMs that are currently in use)",
    "Must integrate with existing Doctor architecture"
  ],
  "scope_in_scope": [
    "src/doctor.ts",
    "src/agent/sprite-core.ts"
  ],
  "scope_out_of_scope": [
    "Real-time monitoring daemon"
  ],
  "priority_hint": "medium",
  "urgency_hint": "Maintenance requirement"
}
